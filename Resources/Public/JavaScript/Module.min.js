define(["jquery"],function(e){"use strict";function t(e){var t=this,r=!1,n=!1;this.initialize=function(){i(),l(),u(),o(),s(),v(),f(),m()};var l=function(){for(var e=document.querySelectorAll(".wizardform > fieldset"),t=document.querySelectorAll("[data-wizardform-gotostep]"),r=document.querySelectorAll(".wizard > a"),n=1;n<e.length;n++)h(e[n]);for(var l=0;l<t.length;l++)t[l].addEventListener("click",function(t){t.preventDefault();var n=this.getAttribute("data-wizardform-gotostep");a(r,"current"),r[n-1].classList.add("current");for(var l=0;l<e.length;l++)h(e[l]);S(e[n-1]),y()})},a=function(e,t){for(var r=0;r<e.length;r++)e[r].classList.remove(t)},i=function(){null!==document.querySelector(".t3js-datetimepicker")&&require(["TYPO3/CMS/Backend/DateTimePicker"],function(e){e.initialize()})},u=function(){var e=document.querySelector('[data-luxletter-wizardpreviewevent="users"]');null!==e&&e.addEventListener("change",function(){x(TYPO3.settings.ajaxUrls["/luxletter/wizardUserPreview"],{usergroup:this.value},"addWizardUserPreviewCallback")})},o=function(){var e=document.querySelector('[data-luxletter-wizardpreviewevent="newsletter"]');null!==e&&e.addEventListener("blur",function(){c()});var t=document.querySelector('[data-luxletter-wizardpreviewevent="layout"]');null!==t&&t.addEventListener("change",function(){c()})},c=function(){var e=document.querySelector('[data-luxletter-wizardpreview="newsletter"]'),t=document.querySelector('[data-luxletter-wizardpreviewevent="newsletter"]');if(null!==e&&""!==t.value){e.innerHTML="";var n=document.createElement("iframe");n.setAttribute("src",d(t.value)),n.setAttribute("class","luxletter-iframepreview"),e.appendChild(n),r=!0,y()}},d=function(e){var t=document.querySelector('[data-luxletter-wizardpreviewevent="layout"]'),r="//"+window.location.host;return r+="/?type=1560777975",r+="&tx_luxletter_fe[origin]="+encodeURIComponent(e),r+="&tx_luxletter_fe[layout]="+encodeURIComponent(t.value)},s=function(){var e=document.querySelector('[data-luxletter-testmail="submit"]');null!==e&&e.addEventListener("click",function(e){e.preventDefault();var t=document.querySelector('[data-luxletter-wizardpreviewevent="newsletter"]').value,r=document.querySelector('[data-luxletter-testmail="email"]').value,n=document.querySelector('[data-luxletter-testmail="subject"]').value,l=document.querySelector('[data-luxletter-testmail="configuration"]').value,a=document.querySelector('[data-luxletter-wizardpreviewevent="layout"]').value;t&&r&&n&&a&&x(TYPO3.settings.ajaxUrls["/luxletter/testMail"],{origin:t,email:r,subject:n,configuration:l,layout:a},"testMailListenerCallback")})},v=function(){for(var e=document.querySelectorAll("[data-luxletter-linkmockaction]"),t=0;t<e.length;t++)e[t].addEventListener("click",function(){var e=this.getAttribute("data-luxletter-linkmockaction");document.querySelector('[data-luxletter-linkmock-link="'+e+'"]').click()})},f=function(){for(var e=document.querySelectorAll("[data-luxletter-action-ajax]"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("data-luxletter-action-ajax");x(TYPO3.settings.ajaxUrls["/luxletter/receiverdetail"],{user:t},"userDetailListenerCallback")})},m=function(){for(var e=document.querySelectorAll("[data-luxletter-confirm]"),t=0;t<e.length;t++)e[t].addEventListener("click",function(e){var t=e.currentTarget.getAttribute("data-luxletter-confirm");confirm(t)===!1&&e.preventDefault()})};this.addWizardUserPreviewCallback=function(e){var t=document.querySelector('[data-luxletter-wizardpreview="users"]');null!==t&&(t.innerHTML=e.html,n=!0,y())},this.testMailListenerCallback=function(e){var t=document.querySelector('[data-luxletter-testmail="message"]');null!==t&&S(t)},this.userDetailListenerCallback=function(e){var t=document.getElementById("luxletter-newsletter-receiver-container");null!==t&&(t.innerHTML=e.html)};var x=function(e,r,n){if(void 0!==e&&""!==e){var l=new XMLHttpRequest;l.onreadystatechange=function(){4===this.readyState&&200===this.status&&null!==n&&t[n](JSON.parse(this.responseText))},l.open("POST",p(e,r),!0),l.send()}else console.log("No ajax URI given!")},y=function(){if(w()&&g())for(var e=document.querySelectorAll("[data-luxletter-wizardstatus]"),t=0;t<e.length;t++)"ready"===e[t].getAttribute("data-luxletter-wizardstatus")?S(e[t]):"pending"===e[t].getAttribute("data-luxletter-wizardstatus")&&h(e[t])},w=function(){return r&&n},g=function(){for(var e=document.querySelectorAll("[data-luxletter-mandatory]"),t=0;t<e.length;t++)if(0===e[t].value||""===e[t].value)return!1;return!0},p=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e+=e.indexOf("?")!==-1?"&":"?",e+=r+"="+encodeURIComponent(t[r]));return e},h=function(e){e.style.display="none"},S=function(e){e.style.display="block"}}e(document).ready(function(){var r=new t(e);r.initialize()})});